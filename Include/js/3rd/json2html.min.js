var json2html={transform:function(e,n,t){var i={events:[],html:""};var r={events:false};r=json2html._extend(r,t);if(n!==undefined||e!==undefined){var s=typeof e==="string"?JSON.parse(e):e;i=json2html._transform(s,n,r)}if(r.events)return i;else return i.html},_extend:function(e,n){var t={};for(var i in e){t[i]=e[i]}for(var i in n){t[i]=n[i]}return t},_append:function(e,n){var t={html:"",event:[]};if(typeof e!=="undefined"&&typeof n!=="undefined"){t.html=e.html+n.html;t.events=e.events.concat(n.events)}return t},_isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},_transform:function(e,n,t){var i={events:[],html:""};if(json2html._isArray(e)){var r=e.length;for(var s=0;s<r;++s){i=json2html._append(i,json2html._apply(e[s],n,s,t))}}else if(typeof e==="object"){i=json2html._append(i,json2html._apply(e,n,undefined,t))}return i},_apply:function(e,n,t,i){var r={events:[],html:""};if(json2html._isArray(n)){var s=n.length;for(var a=0;a<s;++a){r=json2html._append(r,json2html._apply(e,n[a],t,i))}}else if(typeof n==="object"){if(n.tag!==undefined){r.html+="<"+n.tag;var l={events:[],html:""};var f;for(var o in n){switch(o){case"tag":break;case"children":if(json2html._isArray(n.children)){l=json2html._append(l,json2html._apply(e,n.children,t,i))}else if(typeof n.children==="function"){var h=n.children.call(e,e,t);if(typeof h==="object"){if(h.html!==undefined&&h.events!==undefined)l=json2html._append(l,h)}else if(typeof h==="string"){l.html+=h}}break;case"html":f=json2html._getValue(e,n,"html",t);break;default:var d=false;if(o.length>2)if(o.substring(0,2).toLowerCase()=="on"){if(i.events){var u={action:n[o],obj:e,data:i.eventData,index:t};var c=json2html._guid();r.events[r.events.length]={id:c,type:o.substring(2),data:u};r.html+=" json2html-event-id-"+o.substring(2)+"='"+c+"'"}d=true}if(!d){var v=json2html._getValue(e,n,o,t);if(v!==undefined){var m;if(typeof v==="string")m='"'+v.replace(/"/g,"&quot;")+'"';else m=v;r.html+=" "+o+"="+m}}break}}r.html+=">";if(f)r.html+=f;r=json2html._append(r,l);r.html+="</"+n.tag+">"}}return r},_guid:function(){var e=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return e()+e()+"-"+e()+e()+"-"+e()+e()},_getValue:function(e,n,t,i){var r="";var s=n[t];var a=typeof s;if(a==="function"){return s.call(e,e,i)}else if(a==="string"){var l=new json2html._tokenizer([/\$\{([^\}\{]+)\}/],function(n,t,i){return t?n.replace(i,function(n,t){var i=t.split(".");var r=e;var s="";var a=i.length;for(var l=0;l<a;++l){if(i[l].length>0){var f=r[i[l]];r=f;if(r===null||r===undefined)break}}if(r!==null&&r!==undefined)s=r;return s}):n});r=l.parse(s).join("")}else{r=s}return r},_tokenizer:function(e,n){if(!(this instanceof json2html._tokenizer))return new json2html._tokenizer(e,n);this.tokenizers=e.splice?e:[e];if(n)this.doBuild=n;this.parse=function(e){this.src=e;this.ended=false;this.tokens=[];do{this.next()}while(!this.ended);return this.tokens};this.build=function(e,n){if(e)this.tokens.push(!this.doBuild?e:this.doBuild(e,n,this.tkn))};this.next=function(){var e=this,n;e.findMin();n=e.src.slice(0,e.min);e.build(n,false);e.src=e.src.slice(e.min).replace(e.tkn,function(n){e.build(n,true);return""});if(!e.src)e.ended=true};this.findMin=function(){var e=this,n=0,t,i;e.min=-1;e.tkn="";while((t=e.tokenizers[n++])!==undefined){i=e.src[t.test?"search":"indexOf"](t);if(i!=-1&&(e.min==-1||i<e.min)){e.tkn=t;e.min=i}}if(e.min==-1)e.min=e.src.length}}};(function(e){e.fn.json2html=function(n,t,i){if(typeof json2html==="undefined")return undefined;var r={append:true,replace:false,prepend:false,eventData:{}};if(i!==undefined)e.extend(r,i);r.events=true;return this.each(function(){var i=json2html.transform(n,t,r);var s=e(document.createElement("i")).html(i.html);for(var a=0;a<i.events.length;a++){var l=i.events[a];var f=e(s).find("[json2html-event-id-"+l.type+"='"+l.id+"']");if(f.length===0)throw"jquery.json2html was unable to attach event "+l.id+" to DOM";e(f).removeAttr("json2html-event-id-"+l.type);e(f).on(l.type,l.data,function(n){n.data.event=n;n.data.action.call(e(this),n.data)})}if(r.replace)e.fn.replaceWith.call(e(this),e(s).children());else if(r.prepend)e.fn.prepend.call(e(this),e(s).children());else e.fn.append.call(e(this),e(s).children())})}})(jQuery);