var QuestionReader=function(e){var t,o,a,r,s,u,c,l,f,h,p,m,d,g=[],S,b,w,q,y={};y.init=function(n,i,r){y.xmlDOM=t=A(n);d=r||false;m="#"+i+"_";p=e("Scope_2",t).html();o=e("Question",t);h=parseInt(e("Number",t).html());b=new Date;if(d){S=e("#questionResultForm");q="question_review"}else{a=0;s=o.eq(a);l=s.prop("id");q=""}y.nowQuestion=s};function A(e){var t;if(window.DOMParser){var n=new DOMParser;t=n.parseFromString(e,"text/xml")}else{t=new ActiveXObject("Microsoft.XMLDOM");t.async=false;t.loadXML(e)}return t}y.goQuestion=function(t){var n,i,r;if(t=="-1"&&a==0)return;if(t=="+1"&&a>=h)return;if(!d)D();if(t=="-1"){a--}else if(t=="+1"){a++}else{a=t-1}s=o.eq(a);n=s.prop("id");i=x();r={no:a,id:n};if(i)r.Random=i;e.mobile.changePage(q,{data:r})};function x(){var t=null;u=e("Answer",s);r=u.attr("type");if(r){if(r=="groupchoice"){t="";e("Random Sub",s).each(function(e,n){t+=n.innerHTML+";"})}else if(r=="multichoice"){t=e("Random",s).html()}}return t}function z(){e("#questionHead_"+a+" h5").html(p);if(e("Status",s).attr("love")=="true"){e("#love_"+a).attr("data-theme","e")}MathJax.Hub.Queue(["Typeset",MathJax.Hub]);if(sessionStorage.fontSize){e("font",c).prop("size",sessionStorage.fontSize);e("#fontSize"+sessionStorage.fontSize+"_"+a).prop("checked",true)}function t(t,n){var i=e("#ansDiv_"+n+"_"+a+" input[type!=button]");e("Choose[check=true]",t).each(function(e,t){i.eq(t.id).prop("checked",true)})}if(r=="groupchoice"){e("Sub",u).each(function(e,n){t(n,e)})}else if(r=="multichoice"){t(u,0)}else if(r=="cloze"){f=e("font.questiontext",c);var n=e("Ans",u);var i=0;e("input",f).each(function(t,o){o=e(o);v=n.eq(i++).attr("value");v2=o.val();if(d){if(v!=v2){o.after('<span style="background-color:#BBF5B8;">【正解：'+v2+"】</span>").val(v)}o.prop("disabled",true)}else{o.val(v)}});e("select",f).each(function(t,o){o=e(o);v=n.eq(i++).attr("value");v2=o.val();if(d){e2=e("option",o).prop("disabled",true);if(v!=v2){o.after('<span style="background-color:#BBF5B8;">【正解：'+e2.eq(v2).html()+"】</span>").val(v)}}else{o.val(v)}})}}y.showQuestion=function(t){a=t;c=e(m+a);s=o.eq(a);l=s.prop("id");u=e("Answer",s);r=u.attr("type");if(e("Status",s).length==0){T()}else{z()}w=new Date};function M(){var t,n=a+1;if(!d&&n<h&&!g[n]){g[n]=true;e(document).on("pageinit",m+a,function(){t=o.eq(n).prop("id");var i={id:t};e.mobile.loadPage("?no="+n,{data:i,type:"post"})})}}y.clickLove=function(n,i){var o,r;n=e(n);o=n.attr("data-theme")!="e";n.button({theme:o?"e":"c"});e("Status",s).attr("love",o);if(i){n.button("disable");r=e("Exam",t).attr("id");e.post("Question/saveLove",{id:l,examId:r,questionNo:a},function(){n.button("enable")})}};function T(){var t="";t=window.domString;if(t=="cloze"){t="";f=e("font.questiontext",c);n=e("input, select",f).length;for(i=0;i<n;i++)t+='<Ans id="'+i+'" value=""/>';t='<Answer type="cloze">'+t+"</Answer>"}t='<Status guess="false" love="false"/>'+"<StartTime>"+(new Date).format("yyyy-MM-dd hh:mm:ss")+"</StartTime>"+"<AnsTime>0</AnsTime>"+"<Highlight><Title/></Highlight>"+t+"<Result>Error</Result>"+"<Whiteboard/>";s.html(t)}function D(){var t=new Date-w+e("AnsTime",s).html().toInt();t=Math.floor(t/1e3);e("AnsTime",s).html(t);c=e(m+a);u=e("Answer",s);r=u.attr("type");function n(t,n){var i=e("#ansDiv_"+n+"_"+a+" input[type!=button]");var o=e("Choose",t);i.each(function(e,t){o.eq(e).attr("check",t.checked)})}if(r=="groupchoice"){e("Sub",u).each(function(e,t){n(t,e)})}else if(r=="multichoice"){n(u,0)}else if(r=="cloze"){f=e("font.questiontext",c);var i=e("Ans",u);var o=0;e("input",f).each(function(t,n){n=e(n);v2=n.val();v=i.eq(o++).attr("value",v2)});e("select",f).each(function(t,n){n=e(n);v2=n.val();v=i.eq(o++).attr("value",v2)})}}y.changeFontSize=function(t){sessionStorage.fontSize=t;e("font",c).prop("size",sessionStorage.fontSize)};y.finishExam=function(){var n,i="question_result";D();n=(new XMLSerializer).serializeToString(t);examAnsTime=new Date-b;examAnsTime=Math.floor(examAnsTime/1e3);para={xmlString:n,examAnsTime:examAnsTime};para={transition:"fade",type:"post",data:para};e.mobile.changePage(i,para);return};y.finishQuestion=function(){var t,n={isReview:1};t=x();if(t)n.Random=t;d=true;D();n={transition:"fade",type:"get",data:n};e.mobile.changePage("",n);return};y.getQuestions=function(){return o};y.getQuestionNo=function(){return a};return y}(jQuery);